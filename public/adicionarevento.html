<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="home.css">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="bulma.min.css" />
    <link rel="stylesheet" type="text/css" href="login.css">
</head>
<body>
<div class="month">
    <ul>
        <li onclick="adicionarEvento()" class="prev"><img src="../agenda/icons/agenda-icon.png" alt="" width="100" height="100"></li>

        <li class="next"><img src="../agenda/icons/cron.png" alt="" width="100" height="100"></li>
        <li><p id="user_name"> <p>
            <span style="font-size:50px">&#10096;  </span><span style="font-size:45px" id="mes"></span><span style="font-size:50px" onclick="imprimir()">  &#10097;</span>
            <br>
            <span style="font-size:18px;" ><a class="prev" href="home.html">Voltar para o calendario</a></span>
            <span style="font-size:18px">2020</span>

        </li>
    </ul>
</div>
<div class="box">
    <!-- <form> -->
    <div class="field">
        <div class="control">
            <select id="dia" class="input is-large">
            </select>
        </div>
    </div>
    <div class="field">
        <div class="control">
            <select id="mes_input" class="input is-large">
            </select>
        </div>
    </div>
    <div class="field">
        <div class="control">
            <input id="titulo" class="input is-large" type="text" placeholder="Titulo do Evento">
        </div>
    </div>
    <div class="field">
        <div class="control">
            <input id="descricao" class="input is-large" type="text" placeholder="Descrição do evento">
        </div>
    </div>
    <button onclick="validar()" class="button is-block is-link is-large is-fullwidth">Adicionar o evento a agenda!</button>
    <!-- </form> -->
</div>

<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>
<script src="script_meses.js"></script>

<script>
    var firebaseConfig = {
        apiKey: "AIzaSyBMasMxL8BhY9OSyNkAmMZqfMtSlaYDEp8",
        authDomain: "weebdario.firebaseapp.com",
        databaseURL: "https://weebdario.firebaseio.com",
        projectId: "weebdario",
        storageBucket: "weebdario.appspot.com",
        messagingSenderId: "742261135078",
        appId: "1:742261135078:web:67e5be9399087e69efcd27"
    };


    var user = {};

    var mes = new Date().getMonth();
    var diaDaSemanaQueOMesComeca = new Date(2020, mes,1).getDay();
    var diasNosMeses = [31,28,31,30,31, 30,31,31,30,31,30,31];
    var meses = ['Janeiro',
        'Fevereiro',
        'Março',
        'Abril',
        'Maio',
        'Junho',
        'Julho',
        'Agosto',
        'Setembro',
        'Outubro',
        'Novembro',
        'Dezembro'];
    function getUser() {
        return JSON.parse(localStorage.getItem('user'));
    }


    // Your web app's Firebase configuration
    window.onload = function() {
        init();
    };

    function init() {
        user = getUser();
        document.getElementById('mes').innerHTML = meses[mes].toUpperCase();
        document.getElementById('mes_input').value = meses[mes].toUpperCase();
        popularDias();
        popularMeses();
    }

    function popularDias(){
        for(var i = 1; i<=diasNosMeses[mes]; i++){
            document.getElementById('dia').innerHTML+= `<option value="`+i+`">`+i+`</option>`
        }
    }

    function popularMeses(){
        for(var i = 0; i<meses.length; i++){
            if( i == mes){
                document.getElementById('mes_input').innerHTML+= `<option value="`+i+`" selected>`+meses[i]+`</option>`
            }else{
                document.getElementById('mes_input').innerHTML+= `<option value="`+i+`">`+meses[i]+`</option>`
            }
        }
    }
    firebase.initializeApp(firebaseConfig);

    var db = firebase.firestore();
    var evento = {};
    function validar() {
        evento.dia = document.getElementById('dia').value;
        evento.mes = document.getElementById('mes_input').value;
        evento.titulo = document.getElementById('titulo').value;
        evento.descricao = document.getElementById('descricao').value;
        evento.userId = user.id;
        evento.id = makeid();
        registrar()
    }
    function makeid() {
        var text = "";
        var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

        for (var i = 0; i < 10; i++)
            text += possible.charAt(Math.floor(Math.random() * possible.length));

        return text;
    }
    function registrar(){
        db.collection('eventos').doc(evento.id).set(evento).then(
            function () {
                document.location.href = './home.html';
            }
        );
        if(user.eventos)
            user.eventos.push(evento.id);
        db.collection('usuarios').doc(user.id).update(user);
    }
</script>
</body>
</html>
